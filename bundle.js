!function(t){var e={};function n(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,a){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(a,o,function(e){return t[e]}.bind(null,o));return a},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t){t.exports=JSON.parse('{"imgCoord":{"pensil":[-182,-92],"paintBucket":[-228,-92],"paintAllPixels":[-228,-138],"selectColor":[-274,0],"stroke":[-46,-136],"eraser":[-46,-228],"clearCanvas":[0,-228]},"keyboardKeys":{"KeyP":"pensil","KeyB":"paintBucket","KeyL":"paintAllPixels","KeyC":"selectColor","KeyE":"eraser","KeyS":"stroke","KeyX":"clearCanvas"},"sizeArray":["x32","x64","x128"],"miniLineArray":[5,4,3,2],"listenerFunc":{},"color":[],"previousColor":[],"widthLine":1,"isMouseWrite":true,"canvasFocus":false}')},function(t,e,n){"use strict";n.r(e);n(2);var a=n(0);n(6),n(8);class o{constructor(t){this.name=t,this.button=document.createElement("div"),this.button.classList.add("button")}addImage(t){t instanceof Array?this.button.style.backgroundPosition=`${t[0]}px ${t[1]}px`:(this.button.textContent=t,this.button.style.backgroundImage="none")}appendButton(t){t.appendChild(this.button)}initListener(t){this.button.addEventListener("click",t)}}n(12);class i{constructor(){this.button=document.createElement("div"),this.button.classList.add("mini-line-button")}addStyle(t){this.button.style.padding=`${t}px`}appendButton(t){t.appendChild(this.button)}initListener(t){this.button.addEventListener("click",t)}}function s(t){t.forEach(t=>{t.button.classList.remove("button-highlight"),t.button.classList.remove("mini-line-button-highlight")})}function l(t,e,n){const o=Math.abs(t-a.xBeginPath),i=Math.abs(e-a.yBeginPath),s=a.xBeginPath<t?1:-1,l=a.yBeginPath<e?1:-1;let r=o-i;for(;a.xBeginPath!==t||a.yBeginPath!==e;){a.canvas.ctx["paint"===n?"fillRect":"clearRect"](a.xBeginPath,a.yBeginPath,a.widthLine,a.widthLine);const t=2*r;t>-i&&(r-=i,a.xBeginPath+=s),t<o&&(r+=o,a.yBeginPath+=l)}}function r(t){if(a.isMouseWrite){const e=Math.floor(t.offsetX/a.koeffSize),n=Math.floor(t.offsetY/a.koeffSize);a.color=localStorage.getItem("color").split(","),a.canvas.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,l(e,n,"paint")}}function c(t){a.isMouseWrite=!0;const e=Math.floor(t.offsetX/a.koeffSize),n=Math.floor(t.offsetY/a.koeffSize);a.canvas.ctx.beginPath(),a.color=localStorage.getItem("color").split(","),a.canvas.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvas.ctx.fillRect(e,n,a.widthLine,a.widthLine),a.xBeginPath=e,a.yBeginPath=n}function d(t){if(a.isMouseWrite){const e=Math.floor(t.offsetX/a.koeffSize),n=Math.floor(t.offsetY/a.koeffSize);e===a.xBeginPath&&n===a.yBeginPath||(a.canvasAux.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvasAux.ctx.clearRect(0,0,a.canvasAux.node.width,a.canvasAux.node.height),a.canvasAux.ctx.fillRect(a.xBeginPath,a.yBeginPath,a.widthLine,a.widthLine),a.canvasAux.ctx.fillRect(e,n,a.widthLine,a.widthLine),function(t,e){const n=Math.abs(t-a.xBeginPath),o=Math.abs(e-a.yBeginPath),i=a.xBeginPath<t?1:-1,s=a.yBeginPath<e?1:-1;let{xBeginPath:l}=a,{yBeginPath:r}=a,c=n-o;for(;l!==t||r!==e;){a.canvasAux.ctx.fillRect(l,r,a.widthLine,a.widthLine);const t=2*c;t>-o&&(c-=o,l+=i),t<n&&(c+=n,r+=s)}}(e,n,a.canvasAux))}}function h(t){if(a.isMouseWrite){l(Math.floor(t.offsetX/a.koeffSize),Math.floor(t.offsetY/a.koeffSize),"erase")}}function u(t){a.isMouseWrite=!0;const e=Math.floor(t.offsetX/a.koeffSize),n=Math.floor(t.offsetY/a.koeffSize);a.canvas.ctx.beginPath(),a.canvas.ctx.clearRect(e,n,a.widthLine,a.widthLine),a.xBeginPath=e,a.yBeginPath=n}function m(t,e){return!(t>+a.canvas.node.width-1||t<0||e>+a.canvas.node.height-1||e<0)}function f(){const t=a.currentFrame.childNodes[0].childNodes[0],e=t.getContext("2d"),n=new Image;n.src=a.canvas.node.toDataURL(),n.onload=()=>{e.clearRect(0,0,t.width,t.height),e.drawImage(n,0,0,t.width,t.height)}}function v(t){const e=Math.floor(t.offsetX/a.koeffSize),n=Math.floor(t.offsetY/a.koeffSize),o=a.canvas.ctx.getImageData(e,n,1,1);a.color=localStorage.getItem("color").split(","),a.canvas.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvas.ctx.strokeStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvas.ctx.fillStyle=`rgb(${a.color[0]},${a.color[1]},${a.color[2]})`,function(t,e,n,o){const i=[];if(i.push([t,e]),a.canvas.ctx.getImageData(i[0][0],i[0][1],1,1).data.toString()!==o)for(;0!==i.length;){const t=i[0];a.canvas.ctx.getImageData(t[0],t[1],1,1).data.toString()===n&&m(t[0],t[1])&&a.canvas.ctx.fillRect(t[0],t[1],1,1),i.shift(),a.canvas.ctx.getImageData(t[0]+1,t[1],1,1).data.toString()===n&&m(t[0]+1,t[1])&&(a.canvas.ctx.fillRect(t[0]+1,t[1],1,1),i.push([t[0]+1,t[1]])),a.canvas.ctx.getImageData(t[0]-1,t[1],1,1).data.toString()===n&&m(t[0]-1,t[1])&&(a.canvas.ctx.fillRect(t[0]-1,t[1],1,1),i.push([t[0]-1,t[1]])),a.canvas.ctx.getImageData(t[0],t[1]+1,1,1).data.toString()===n&&m(t[0],t[1]+1)&&(a.canvas.ctx.fillRect(t[0],t[1]+1,1,1),i.push([t[0],t[1]+1])),a.canvas.ctx.getImageData(t[0],t[1]-1,1,1).data.toString()===n&&m(t[0],t[1]-1)&&(a.canvas.ctx.fillRect(t[0],t[1]-1,1,1),i.push([t[0],t[1]-1]))}}(e,n,o.data.toString(),localStorage.getItem("color")),f(),localStorage.setItem("graduate","true")}function p(t){if(a.canvasFocus){const e=Math.floor(t.offsetX/a.koeffSize),n=Math.floor(t.offsetY/a.koeffSize),o=a.canvas.ctx.getImageData(e,n,1,1),i=a.canvas.ctx.getImageData(0,0,a.canvas.node.width,a.canvas.node.height),{data:s}=i,l=4,r=0,c=1,d=2,h=3;for(let t=0;t<s.length;t+=l)if(o.data[r]===s[t]&&o.data[c]===s[t+c]&&o.data[d]===s[t+d]&&o.data[h]===s[t+h])for(let e=0;e<l;e+=1){s[t+e]=a.color[e]}a.canvas.ctx.putImageData(i,0,0),f()}}function g(){a.canvasAux.node.style.zIndex="-1",a.canvas.node.removeEventListener("mousedown",c),a.canvas.node.removeEventListener("mousemove",r),a.canvas.node.removeEventListener("mousemove",d),a.canvas.node.removeEventListener("mousedown",u),a.canvas.node.removeEventListener("mousemove",h),a.canvas.node.removeEventListener("click",v),a.canvas.node.removeEventListener("click",p),a.canvasAux.node.removeEventListener("mousedown",c),a.canvasAux.node.removeEventListener("mousemove",d)}function b(){s(a.toolButtons),g(),a.toolButtons[a.toolButtonsName.indexOf("pensil")].button.classList.add("button-highlight"),a.canvas.ctx.lineWidth=a.widthLine,a.canvas.node.addEventListener("mousedown",c),a.canvas.node.addEventListener("mousemove",r)}function x(){s(a.toolButtons),g(),a.toolButtons[a.toolButtonsName.indexOf("paintBucket")].button.classList.add("button-highlight"),a.canvas.node.addEventListener("click",v)}function L(t){if(a.canvasFocus){const e=Math.floor(t.offsetX/a.koeffSize),n=Math.floor(t.offsetY/a.koeffSize),o=a.canvas.ctx.getImageData(e,n,1,1);o.data.toString()!==localStorage.getItem("color")&&(localStorage.setItem("prevColor",localStorage.getItem("color")),localStorage.setItem("color",o.data),a.color=localStorage.getItem("color").split(","),a.prevColor=localStorage.getItem("prevColor").split(","),"0"===a.color[3]&&(a.color.splice(0,4,"255","255","255","255"),localStorage.setItem("color",a.color)),a.inputColorLabel.style.backgroundColor=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.inputPrevColor.style.backgroundColor=`rgb(${a.prevColor[0]}, ${a.prevColor[1]}, ${a.prevColor[2]})`)}}function y(){s(a.toolButtons),g(),a.toolButtons[a.toolButtonsName.indexOf("selectColor")].button.classList.add("button-highlight"),document.body.addEventListener("mousedown",L)}function C(){s(a.toolButtons),g(),a.toolButtons[a.toolButtonsName.indexOf("eraser")].button.classList.add("button-highlight"),a.canvas.node.addEventListener("mousedown",u),a.canvas.node.addEventListener("mousemove",h)}function w(t){if(a.isMouseWrite){const e=Math.floor(t.offsetX/a.koeffSize),n=Math.floor(t.offsetY/a.koeffSize);a.canvas.ctx.fillRect(e,n,a.widthLine,a.widthLine);const o=Math.abs(e-a.xBeginPath),i=Math.abs(n-a.yBeginPath),s=a.xBeginPath<e?1:-1,l=a.yBeginPath<n?1:-1;let{xBeginPath:r}=a,{yBeginPath:c}=a,d=o-i;for(;r!==e||c!==n;){a.canvas.ctx.fillRect(r,c,a.widthLine,a.widthLine);const t=2*d;t>-i&&(d-=i,r+=s),t<o&&(d+=o,c+=l)}}}function P(){s(a.toolButtons),g(),a.toolButtons[a.toolButtonsName.indexOf("stroke")].button.classList.add("button-highlight"),a.canvasAux.node.style.zIndex="2",a.canvasAux.ctx.clearRect(0,0,a.canvasAux.node.width,a.canvasAux.node.height),a.canvasAux.node.addEventListener("mousedown",c),a.canvasAux.node.addEventListener("mousemove",d),a.canvasAux.node.addEventListener("mouseup",w)}function S(){const t=a.toolButtons[a.toolButtonsName.indexOf("clearCanvas")].button;t.classList.add("button-highlight"),setTimeout(()=>{t.classList.remove("button-highlight")},100),a.canvas.ctx.clearRect(0,0,a.canvas.node.width,a.canvas.node.height),f()}function E(t){s(a.toolMiniButtons),this.button.classList.add("mini-line-button-highlight"),a.widthLine=t}n(14);class B{constructor(){this.colorMenu=document.createElement("div"),this.curColor=document.createElement("label"),this.inputColor=document.createElement("input"),this.prevColor=document.createElement("div"),this.changeButton=document.createElement("div"),this.colorMenu.classList.add("color-menu"),this.curColor.classList.add("color-menu__cur-color"),this.prevColor.classList.add("color-menu__prev-color"),this.inputColor.classList.add("color-menu__input"),this.changeButton.classList.add("color-menu__change-button"),this.inputColor.type="color",this.inputColor.id="color",this.curColor.htmlFor="color",a.inputColor=this.inputColor,a.inputColorLabel=this.curColor,a.inputPrevColor=this.prevColor}initListeners(t,e){this.changeButton.addEventListener("click",t),this.inputColor.addEventListener("change",e)}appendMenu(t){this.colorMenu.appendChild(this.curColor),this.colorMenu.appendChild(this.prevColor),this.colorMenu.appendChild(this.inputColor),this.colorMenu.appendChild(this.changeButton),t.appendChild(this.colorMenu)}}function I(){localStorage.setItem("prevColor",localStorage.getItem("color")),localStorage.setItem("color",a.color),a.prevColor=localStorage.getItem("prevColor").split(","),a.inputColorLabel.style.backgroundColor=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.inputPrevColor.style.backgroundColor=`rgb(${a.prevColor[0]}, ${a.prevColor[1]}, ${a.prevColor[2]})`}function N(){const t=parseInt(a.inputColor.value[1]+a.inputColor.value[2],16),e=parseInt(a.inputColor.value[3]+a.inputColor.value[4],16),n=parseInt(a.inputColor.value[5]+a.inputColor.value[6],16);localStorage.getItem("color")!==`${t},${e},${n},255`&&(a.color[0]=t,a.color[1]=e,a.color[2]=n,a.color[3]="255",I(),a.inputColorLabel.style.backgroundColor=`rgb(${t},${e},${n})`)}function k(){const t=localStorage.getItem("prevColor");a.color=t.split(","),I()}function M(){s(a.toolButtons),g(),a.toolButtons[a.toolButtonsName.indexOf("paintAllPixels")].button.classList.add("button-highlight"),a.canvas.ctx.lineWidth=a.widthLine,a.canvas.node.addEventListener("click",p)}class ${constructor(){this.toolsPanel=document.createElement("div"),this.lineWidthPanel=document.createElement("div"),this.toolsPanel.classList.add("tools-panel"),this.lineWidthPanel.classList.add("tools-panel__line-width"),this.buttons=[],this.miniButtons=[],a.listenerFunc={pensil:b,paintBucket:x,paintAllPixels:M,selectColor:y,eraser:C,stroke:P,clearCanvas:S}}appendPanel(t){a.miniLineArray.forEach((t,e)=>{const n=new i;e||n.button.classList.add("mini-line-button-highlight"),n.addStyle(t),n.appendButton(this.lineWidthPanel),n.initListener(E.bind(n,e+1)),this.miniButtons[e]=n}),this.toolsPanel.appendChild(this.lineWidthPanel),this.buttonsName=Object.keys(a.imgCoord),this.buttonsName.forEach((t,e)=>{const n=new o(t);n.addImage(a.imgCoord[t]),n.appendButton(this.toolsPanel),n.initListener(a.listenerFunc[t]),this.buttons[e]=n}),this.colorMenu=new B,this.colorMenu.appendMenu(this.toolsPanel),this.colorMenu.initListeners(k,N),a.toolMiniButtons=this.miniButtons,a.toolButtons=this.buttons,a.toolButtonsName=this.buttonsName,localStorage.getItem("color")?(a.color=localStorage.getItem("color").split(","),a.previousColor=localStorage.getItem("prevColor").split(","),a.inputColorLabel.style.backgroundColor=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.inputPrevColor.style.backgroundColor=`rgb(${a.previousColor[0]}, \n          ${a.previousColor[1]}, ${a.previousColor[2]})`):(localStorage.setItem("color","0,0,0,255"),localStorage.setItem("prevColor","255,255,255,0"),a.inputColorLabel.style.backgroundColor="rgb(0, 0, 0)",a.inputPrevColor.style.backgroundColor="rgb(255, 255, 255)"),t.appendChild(this.toolsPanel)}}n(16);function F(t,e){s(a.sizeButtons),a.sizeButtons[a.sizeArray.indexOf(`x${e}`)].button.classList.add("button-highlight"),localStorage.setItem("canvas",a.canvas.node.toDataURL()),a.canvas.node.height=e,a.canvas.node.width=e,a.canvasAux.node.height=e,a.canvasAux.node.width=e,a.animationPlayer.height=e,a.animationPlayer.width=e,a.koeffSize=t,localStorage.setItem("canvasSize",a.canvas.node.width),localStorage.setItem("sizeKoeff",a.koeffSize),a.canvas.ctx.imageSmoothingEnabled=!1,a.frames.forEach(t=>{const n=t,o=new Image,i=n.childNodes[0].childNodes[0].width,s=n.childNodes[0].childNodes[0].getContext("2d");o.src=n.childNodes[0].childNodes[0].toDataURL(),n.childNodes[0].childNodes[0].width=e,n.childNodes[0].childNodes[0].height=e,o.onload=()=>{s.clearRect(0,0,e,e),s.drawImage(o,0,0,i,i),t===a.currentFrame&&a.canvas.ctx.drawImage(o,0,0,i,i)}})}class z{constructor(){this.sizePanel=document.createElement("div"),this.sizePanel.classList.add("size-panel"),this.buttons=[]}appendPanel(t){a.sizeArray.forEach((t,e)=>{const n=new o(t),a=function(t){const e=2**t*32;return[512/e,e]}(e);n.addImage(t),n.initListener(F.bind(n,a[0],a[1])),n.button.classList.add(`x${a[1]}`),n.appendButton(this.sizePanel),this.buttons[e]=n,a[1]===+localStorage.getItem("canvasSize")&&n.button.classList.add("button-highlight")}),a.sizeButtons=this.buttons,t.appendChild(this.sizePanel)}}n(18);class A{constructor(t){"main"===t?(this.canvas=a.canvas.node,this.ctx=a.canvas.ctx,a.canvas.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvas.ctx.strokeStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,localStorage.getItem("canvasSize")?(a.canvas.node.width=localStorage.getItem("canvasSize"),a.canvas.node.height=localStorage.getItem("canvasSize"),a.koeffSize=+localStorage.getItem("sizeKoeff")):(localStorage.setItem("canvasSize",32),localStorage.setItem("sizeKoeff",16),a.canvas.node.width="32",a.canvas.node.height="32",a.koeffSize=16),a.canvas.node.addEventListener("mouseout",()=>{a.isMouseWrite=!1,a.canvasFocus=!1}),a.canvas.node.addEventListener("mousemove",t=>{a.canvasFocus=!0}),document.body.addEventListener("mouseup",()=>{f(),a.isMouseWrite=!1}),a.canvas.ctx.imageSmoothingEnabled=!1):(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),a.canvasAux={node:this.canvas,ctx:this.ctx},this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.background="none",this.canvas.style.zIndex="-1",a.color=localStorage.getItem("color").split(","),a.previousColor=localStorage.getItem("prevColor").split(","),a.canvasAux.node.width=localStorage.getItem("canvasSize"),a.canvasAux.node.height=localStorage.getItem("canvasSize"),a.canvasAux.node.addEventListener("mouseout",t=>{a.isMouseWrite&&(w(t),a.canvasAux.ctx.clearRect(0,0,a.canvasAux.node.width,a.canvasAux.node.height)),a.isMouseWrite=!1,a.canvasFocus=!1}),document.body.addEventListener("mouseup",()=>{a.canvasAux.ctx.clearRect(0,0,a.canvasAux.node.width,a.canvasAux.node.height)}),a.canvasAux.node.addEventListener("mousemove",t=>{a.canvasFocus=!0})),this.canvas.classList.add("canvas")}appendCanvas(t){t.appendChild(this.canvas)}}n(21),n(23);function _(){a.frames.forEach((t,e)=>{t.childNodes[0].childNodes[1].textContent=e+1})}function R(){1===a.frames.length?(a.frames[0].childNodes[0].childNodes[2].style.display="none",a.frames[0].childNodes[0].childNodes[4].style.display="none"):(a.frames[0].childNodes[0].childNodes[2].style.display="block",a.frames[0].childNodes[0].childNodes[4].style.display="block")}function W(t){const e=t;e.childNodes[0].childNodes[2].style.visibility="visible",e.childNodes[0].childNodes[3].style.visibility="visible",e.childNodes[0].childNodes[4].style.visibility="visible"}function O(t){const e=t;e.childNodes[0].childNodes[2].style.visibility="hidden",e.childNodes[0].childNodes[3].style.visibility="hidden",e.childNodes[0].childNodes[4].style.visibility="hidden"}function D(t){let e=0;a.frameInterval=setInterval(()=>{const t=a.frames[e].childNodes[0].childNodes[0],n=new Image;n.src=t.toDataURL(),n.onload=()=>{a.animationCtx.clearRect(0,0,a.animationPlayer.width,a.animationPlayer.height),a.animationCtx.drawImage(n,0,0,a.animationPlayer.width,a.animationPlayer.height)},e+=1,e===a.frames.length&&(e=0)},t)}function Y(t){const e=(t.target||t.childNodes[0].childNodes[0]).closest(".frames-panel__frame");e&&(a.frames.forEach(t=>{t.childNodes[0].classList.remove("frame-highlight")}),e.classList.add("frame-highlight"),a.currentFrame=e.parentNode,function(t){const e=t.childNodes[0].childNodes[0],n=new Image;a.canvas.ctx.clearRect(0,0,a.canvas.node.width,a.canvas.node.height),n.src=e.toDataURL(),n.onload=()=>{a.canvas.ctx.drawImage(n,0,0,a.canvas.node.width,a.canvas.node.height)}}(a.currentFrame))}function K(t){t.removeEventListener("click",K),t.removeEventListener("mouseover",W),t.removeEventListener("mouseout",O),t.remove(),a.frames.splice(a.frames.indexOf(t),1),_(),R(),clearInterval(a.frameInterval),D(a.timeInterval),setTimeout(Y.bind(null,a.frames[a.frames.length-1]),0)}const X=80,T=13;function j(t,e,n){if(a.drag){const o=t,i=104,s=a.frames[a.frames.indexOf(e)+1],l=a.frames[a.frames.indexOf(e)-1];let r=0;if(o.style.top=`${n.pageY-X}px`,o.style.left=`${n.pageX-T}px`,n.pageY-a.startY>i/2&&s){s.after(e);const t=a.frames.indexOf(e),n=a.frames.indexOf(s);r=a.frames[t],a.frames[t]=a.frames[n],a.frames[n]=r,a.startY+=i}if(a.startY-n.pageY>i/2&&l){l.before(e);const t=a.frames.indexOf(e),n=a.frames.indexOf(l);r=a.frames[t],a.frames[t]=a.frames[n],a.frames[n]=r,a.startY-=i}_()}}function U(t,e){const n=t,o=e;n.style.position="relative",n.style.top="0",n.style.left="0",n.style.zIndex="1",a.drag=!1,o.style.border="none",document.body.removeEventListener("mousemove",a.move),document.body.removeEventListener("mouseup",a.drop)}function H(t,e,n){a.drag=!0;const o=t,i=e;a.startY=n.pageY,o.style.top=`${n.pageY-X}px`,o.style.left=`${n.pageX-T}px`,o.style.position="absolute",o.style.zIndex="4",i.style.border="3px dashed orange",a.move=j.bind(document.body,t,e),a.drop=U.bind(document.body,t,e),document.body.addEventListener("mousemove",a.move),document.body.addEventListener("mouseup",a.drop)}function J(t){const e=t.cloneNode(!0),n=t.childNodes[0].childNodes[0],o=e.childNodes[0].childNodes[0],i=o.getContext("2d");t.after(e);const s=new Image;s.src=n.toDataURL(),s.onload=()=>{i.drawImage(s,0,0,o.width,o.height)},e.childNodes[0].childNodes[2].style.display="block",e.childNodes[0].childNodes[4].style.display="block",e.childNodes[0].childNodes[2].style.visibility="hidden",e.childNodes[0].childNodes[3].style.visibility="hidden",e.childNodes[0].childNodes[4].style.visibility="hidden",e.addEventListener("mouseover",W.bind(e,e)),e.addEventListener("mouseout",O.bind(e,e)),e.childNodes[0].childNodes[2].addEventListener("click",K.bind(e,e)),e.childNodes[0].childNodes[3].addEventListener("click",J.bind(e,e)),e.childNodes[0].childNodes[4].addEventListener("mousedown",H.bind(e.childNodes[0].childNodes[4],e.childNodes[0],e)),a.frames.splice(a.frames.indexOf(t)+1,0,e),_(),R()}class q{constructor(){this.buttonAdd=document.createElement("li"),this.buttonAdd.classList.add("frames-panel__add-button"),this.buttonAdd.innerHTML='<div class="frames-panel__add-button_img" ></div>\n                                <div class="frames-panel__add-button_text">Add new frame</div>'}createFrame(){this.newFrameWrap=document.createElement("li"),this.newFrame=document.createElement("div"),this.canvas=document.createElement("canvas"),this.number=document.createElement("div"),this.buttonDel=document.createElement("div"),this.buttonDublic=document.createElement("div"),this.buttonMove=document.createElement("div"),this.canvas.width=localStorage.getItem("canvasSize")||"32",this.canvas.height=localStorage.getItem("canvasSize")||"32",this.newFrameWrap.classList.add("frame-wrapper"),this.newFrame.classList.add("frames-panel__frame"),this.number.classList.add("frames-panel__frame_number"),this.buttonDel.classList.add("frames-panel__frame_del-button"),this.buttonDublic.classList.add("frames-panel__frame_dbl-button"),this.buttonMove.classList.add("frames-panel__frame_move-button"),this.newFrame.appendChild(this.canvas),this.newFrame.appendChild(this.number),this.newFrame.appendChild(this.buttonDel),this.newFrame.appendChild(this.buttonDublic),this.newFrame.appendChild(this.buttonMove),this.newFrameWrap.appendChild(this.newFrame),this.buttonMove.addEventListener("mousedown",H.bind(this.buttonMove,this.newFrame,this.newFrameWrap)),this.newFrame.addEventListener("mouseover",W.bind(this.newFrameWrap,this.newFrameWrap)),this.newFrame.addEventListener("mouseout",O.bind(this.newFrameWrap,this.newFrameWrap)),this.buttonDel.addEventListener("click",K.bind(this.newFrameWrap,this.newFrameWrap)),this.buttonDublic.addEventListener("click",J.bind(this.newFrameWrap,this.newFrameWrap)),this.buttonAdd.before(this.newFrameWrap),a.frames.push(this.newFrameWrap),a.currentFrame=this.newFrame,_(),R(),Y(this.newFrameWrap)}appendButton(t){t.appendChild(this.buttonAdd)}}class G{constructor(){if(this.framesPanel=document.createElement("ul"),this.framesPanel.classList.add("frames-panel"),a.framesPanel=this.framesPanel,a.frames=[],a.frameWrappers=[],this.frameBar=new q,this.frameBar.appendButton(this.framesPanel),localStorage.getItem("frames"))!function(t){if(localStorage.getItem("frames")){JSON.parse(localStorage.getItem("frames")).forEach((e,n)=>{t();const o=a.frames[n].childNodes[0].childNodes[0],i=o.getContext("2d"),s=new Image;s.src=e,s.onload=()=>{i.drawImage(s,0,0,o.width,o.height),n===a.frames.length-1&&Y(a.frames[a.frames.length-1])}})}}(this.frameBar.createFrame.bind(this.frameBar));else{this.frameBar.createFrame();const t=a.frames[0];a.currentFrame=t}this.frameBar.buttonAdd.addEventListener("click",this.frameBar.createFrame.bind(this.frameBar)),this.framesPanel.addEventListener("click",Y)}appendPanel(t){t.appendChild(this.framesPanel)}}n(25);class Q{constructor(){this.range=document.createElement("input"),this.fpsText=document.createElement("div"),this.range.classList.add("animation-panel__range"),this.fpsText.classList.add("animation-panel__fps-text"),this.range.type="range",this.range.min=1,this.range.max=24,this.range.value=12,this.fpsText.textContent=`${this.range.value} fps`}initListener(t){this.range.addEventListener("change",t)}}function V(t,e){const n=t,o=e.target.value,i=1e3/a.animationRange.value;a.timeInterval=i,n.textContent=`${o} fps`,clearInterval(a.frameInterval),D(i)}function Z(){this.animationPanel.classList.toggle("full-screen"),this.animationPlayer.classList.toggle("full-screen-player"),this.animationRange.range.classList.toggle("full-screen-range"),this.animationRange.fpsText.classList.toggle("full-screen-fps")}class tt{constructor(){this.animationPanel=document.createElement("div"),this.animationPlayer=document.createElement("canvas"),this.buttonFullScreen=document.createElement("div"),this.animationCtx=this.animationPlayer.getContext("2d"),this.animationRange=new Q,this.animationPanel.classList.add("animation-panel"),this.animationPlayer.classList.add("animation-panel__player"),this.buttonFullScreen.classList.add("animation-panel__screen-button"),this.buttonFullScreen.addEventListener("click",Z.bind(this)),this.animationRange.initListener(V.bind(this.AnimationRange,this.animationRange.fpsText)),this.animationPlayer.width=a.canvas.node.width,this.animationPlayer.height=a.canvas.node.height,a.animationPlayer=this.animationPlayer,a.animationCtx=this.animationCtx,a.animationRange=this.animationRange.range}animationStart(){this.timeInterval=1e3/+this.animationRange.range.value,a.timeInterval=this.timeInterval,D(this.timeInterval)}appendPanel(t){this.animationPanel.appendChild(this.animationPlayer),this.animationPanel.appendChild(this.buttonFullScreen),this.animationPanel.appendChild(this.animationRange.fpsText),this.animationPanel.appendChild(this.animationRange.range),t.appendChild(this.animationPanel)}}n(27);function et(){const t=Math.round(1e3/a.timeInterval),e=a.canvas.node.width,n=new GIFEncoder;n.setSize(e,e),n.setRepeat(0),n.setFrameRate(t),n.start(),a.frames.forEach(t=>{const e=t.childNodes[0].childNodes[0].getContext("2d");n.addFrame(e)}),n.finish(),n.download("piskel.gif")}function nt(){const t=[];a.frames.forEach(e=>{const n=e.childNodes[0].childNodes[0].toDataURL();t.push(n)}),localStorage.setItem("frames",JSON.stringify(t))}class at{constructor(){this.exportPanel=document.createElement("div"),this.exportPanel.classList.add("export-panel"),this.gifExport=new o("gif"),this.gifExport.addImage([0,-182]),this.gifExport.appendButton(this.exportPanel),this.gifExport.initListener(et),this.saveLocal=new o("local"),this.saveLocal.addImage([-228,0]),this.saveLocal.appendButton(this.exportPanel),this.saveLocal.initListener(nt)}appendPanel(t){t.appendChild(this.exportPanel)}}n(29);function ot(){}class it{constructor(){this.header=document.createElement("header"),this.title=document.createElement("h1"),this.regButton=document.createElement("div"),this.regButton.classList.add("g-signin2"),this.regButton.setAttribute("data-onsuccess","onSignIn"),this.regButton.textContent="Reg",this.title.textContent="SiMPLE PiSKEL CLONE",this.regButton.addEventListener("click",ot)}appendHeader(t){this.header.appendChild(this.title),this.header.appendChild(this.regButton),t.appendChild(this.header)}}const st=document.querySelector(".wrapper");(new class{constructor(){this.main=document.createElement("main"),this.main.setAttribute("onselectstart","return false"),this.canvasWrap=document.createElement("div"),this.container=document.createElement("div"),this.rightButtonCont=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrapper"),this.container.classList.add("canvases-container"),this.rightButtonCont.classList.add("size-export-container");const t=document.createElement("canvas"),e=t.getContext("2d");a.canvas={node:t,ctx:e}}appendApp(t){this.header=new it,this.header.appendHeader(t),this.toolsPanel=new $,this.toolsPanel.appendPanel(this.main),this.framesPanel=new G,this.framesPanel.appendPanel(this.main),this.canvas=new A("main"),this.canvas.appendCanvas(this.canvasWrap),this.canvasAux=new A("auxiliary"),this.canvasAux.appendCanvas(this.canvasWrap),this.container.appendChild(this.canvasWrap),this.main.appendChild(this.container),this.animationPanel=new tt,this.animationPanel.appendPanel(this.main),this.animationPanel.animationStart(),this.sizePanel=new z,this.sizePanel.appendPanel(this.rightButtonCont),this.exportPanel=new at,this.exportPanel.appendPanel(this.rightButtonCont),this.main.appendChild(this.rightButtonCont),t.appendChild(this.main)}}).appendApp(st),window.addEventListener("keydown",(function(t){Object.keys(a.keyboardKeys).forEach(e=>{e===t.code&&a.listenerFunc[a.keyboardKeys[e]]()})}))},function(t,e){},,,,function(t,e){},,function(t,e){},,,,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){},,function(t,e){}]);