!function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(a,o,function(t){return e[t]}.bind(null,o));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e){e.exports=JSON.parse('{"imgCoord":{"pensil":[-182,-92],"paintBucket":[-228,-92],"paintAllPixels":[-228,-138],"selectColor":[-274,0],"stroke":[-46,-136],"eraser":[-46,-228],"clearCanvas":[0,-228]},"keyboardKeys":{"KeyP":"pensil","KeyB":"paintBucket","KeyL":"paintAllPixels","KeyC":"selectColor","KeyE":"eraser","KeyS":"stroke","KeyX":"clearCanvas"},"sizeArray":["x32","x64","x128"],"miniLineArray":[5,4,3,2],"listenerFunc":{},"color":[],"previousColor":[],"widthLine":1,"isMouseWrite":true,"canvasFocus":false}')},function(e,t,n){"use strict";n.r(t);n(2);var a=n(0);n(6),n(8);class o{constructor(e){this.name=e,this.button=document.createElement("div"),this.button.classList.add("button")}addImage(e){e instanceof Array?this.button.style.backgroundPosition=`${e[0]}px ${e[1]}px`:(this.button.textContent=e,this.button.style.backgroundImage="none")}appendButton(e){e.appendChild(this.button)}initListener(e){this.button.addEventListener("click",e)}}n(12);class i{constructor(){this.button=document.createElement("div"),this.button.classList.add("mini-line-button")}addStyle(e){this.button.style.padding=`${e}px`}appendButton(e){e.appendChild(this.button)}initListener(e){this.button.addEventListener("click",e)}}function s(e){e.forEach(e=>{e.button.classList.remove("button-highlight"),e.button.classList.remove("mini-line-button-highlight")})}function l(e,t,n){const o=Math.abs(e-a.xBeginPath),i=Math.abs(t-a.yBeginPath),s=a.xBeginPath<e?1:-1,l=a.yBeginPath<t?1:-1;let r=o-i;for(;a.xBeginPath!==e||a.yBeginPath!==t;){a.canvas.ctx["paint"===n?"fillRect":"clearRect"](a.xBeginPath,a.yBeginPath,a.widthLine,a.widthLine);const e=2*r;e>-i&&(r-=i,a.xBeginPath+=s),e<o&&(r+=o,a.yBeginPath+=l)}}function r(e){if(a.isMouseWrite){const t=Math.floor(e.offsetX/a.koeffSize),n=Math.floor(e.offsetY/a.koeffSize);a.color=localStorage.getItem("color").split(","),a.canvas.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,l(t,n,"paint")}}function c(e){a.isMouseWrite=!0;const t=Math.floor(e.offsetX/a.koeffSize),n=Math.floor(e.offsetY/a.koeffSize);a.canvas.ctx.beginPath(),a.color=localStorage.getItem("color").split(","),a.canvas.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvas.ctx.fillRect(t,n,a.widthLine,a.widthLine),a.xBeginPath=t,a.yBeginPath=n}function d(e){if(a.isMouseWrite){const t=Math.floor(e.offsetX/a.koeffSize),n=Math.floor(e.offsetY/a.koeffSize);t===a.xBeginPath&&n===a.yBeginPath||(a.canvasAux.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvasAux.ctx.clearRect(0,0,a.canvasAux.node.width,a.canvasAux.node.height),a.canvasAux.ctx.fillRect(a.xBeginPath,a.yBeginPath,a.widthLine,a.widthLine),a.canvasAux.ctx.fillRect(t,n,a.widthLine,a.widthLine),function(e,t){const n=Math.abs(e-a.xBeginPath),o=Math.abs(t-a.yBeginPath),i=a.xBeginPath<e?1:-1,s=a.yBeginPath<t?1:-1;let{xBeginPath:l}=a,{yBeginPath:r}=a,c=n-o;for(;l!==e||r!==t;){a.canvasAux.ctx.fillRect(l,r,a.widthLine,a.widthLine);const e=2*c;e>-o&&(c-=o,l+=i),e<n&&(c+=n,r+=s)}}(t,n,a.canvasAux))}}function h(e){if(a.isMouseWrite){l(Math.floor(e.offsetX/a.koeffSize),Math.floor(e.offsetY/a.koeffSize),"erase")}}function u(e){a.isMouseWrite=!0;const t=Math.floor(e.offsetX/a.koeffSize),n=Math.floor(e.offsetY/a.koeffSize);a.canvas.ctx.beginPath(),a.canvas.ctx.clearRect(t,n,a.widthLine,a.widthLine),a.xBeginPath=t,a.yBeginPath=n}function m(e,t){return!(e>+a.canvas.node.width-1||e<0||t>+a.canvas.node.height-1||t<0)}function f(){const e=a.currentFrame.childNodes[0].childNodes[0],t=e.getContext("2d"),n=new Image;n.src=a.canvas.node.toDataURL(),n.onload=()=>{t.clearRect(0,0,e.width,e.height),t.drawImage(n,0,0,e.width,e.height)}}function p(e){const t=Math.floor(e.offsetX/a.koeffSize),n=Math.floor(e.offsetY/a.koeffSize),o=a.canvas.ctx.getImageData(t,n,1,1);a.color=localStorage.getItem("color").split(","),a.canvas.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvas.ctx.strokeStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvas.ctx.fillStyle=`rgb(${a.color[0]},${a.color[1]},${a.color[2]})`,function(e,t,n,o){const i=[];if(i.push([e,t]),a.canvas.ctx.getImageData(i[0][0],i[0][1],1,1).data.toString()!==o)for(;0!==i.length;){const e=i[0];a.canvas.ctx.getImageData(e[0],e[1],1,1).data.toString()===n&&m(e[0],e[1])&&a.canvas.ctx.fillRect(e[0],e[1],1,1),i.shift(),a.canvas.ctx.getImageData(e[0]+1,e[1],1,1).data.toString()===n&&m(e[0]+1,e[1])&&(a.canvas.ctx.fillRect(e[0]+1,e[1],1,1),i.push([e[0]+1,e[1]])),a.canvas.ctx.getImageData(e[0]-1,e[1],1,1).data.toString()===n&&m(e[0]-1,e[1])&&(a.canvas.ctx.fillRect(e[0]-1,e[1],1,1),i.push([e[0]-1,e[1]])),a.canvas.ctx.getImageData(e[0],e[1]+1,1,1).data.toString()===n&&m(e[0],e[1]+1)&&(a.canvas.ctx.fillRect(e[0],e[1]+1,1,1),i.push([e[0],e[1]+1])),a.canvas.ctx.getImageData(e[0],e[1]-1,1,1).data.toString()===n&&m(e[0],e[1]-1)&&(a.canvas.ctx.fillRect(e[0],e[1]-1,1,1),i.push([e[0],e[1]-1]))}}(t,n,o.data.toString(),localStorage.getItem("color")),f(),localStorage.setItem("graduate","true")}function g(e){if(a.canvasFocus){const t=Math.floor(e.offsetX/a.koeffSize),n=Math.floor(e.offsetY/a.koeffSize),o=a.canvas.ctx.getImageData(t,n,1,1),i=a.canvas.ctx.getImageData(0,0,a.canvas.node.width,a.canvas.node.height),{data:s}=i,l=4,r=0,c=1,d=2,h=3;for(let e=0;e<s.length;e+=l)if(o.data[r]===s[e]&&o.data[c]===s[e+c]&&o.data[d]===s[e+d]&&o.data[h]===s[e+h])for(let t=0;t<l;t+=1){s[e+t]=a.color[t]}a.canvas.ctx.putImageData(i,0,0),f()}}function v(){a.canvasAux.node.style.zIndex="-1",a.canvas.node.removeEventListener("mousedown",c),a.canvas.node.removeEventListener("mousemove",r),a.canvas.node.removeEventListener("mousemove",d),a.canvas.node.removeEventListener("mousedown",u),a.canvas.node.removeEventListener("mousemove",h),a.canvas.node.removeEventListener("click",p),a.canvas.node.removeEventListener("click",g),a.canvasAux.node.removeEventListener("mousedown",c),a.canvasAux.node.removeEventListener("mousemove",d)}function b(){s(a.toolButtons),v(),a.toolButtons[a.toolButtonsName.indexOf("pensil")].button.classList.add("button-highlight"),a.canvas.ctx.lineWidth=a.widthLine,a.canvas.node.addEventListener("mousedown",c),a.canvas.node.addEventListener("mousemove",r)}function x(){s(a.toolButtons),v(),a.toolButtons[a.toolButtonsName.indexOf("paintBucket")].button.classList.add("button-highlight"),a.canvas.node.addEventListener("click",p)}function L(e){if(a.canvasFocus){const t=Math.floor(e.offsetX/a.koeffSize),n=Math.floor(e.offsetY/a.koeffSize),o=a.canvas.ctx.getImageData(t,n,1,1);o.data.toString()!==localStorage.getItem("color")&&(localStorage.setItem("prevColor",localStorage.getItem("color")),localStorage.setItem("color",o.data),a.color=localStorage.getItem("color").split(","),a.prevColor=localStorage.getItem("prevColor").split(","),"0"===a.color[3]&&(a.color.splice(0,4,"255","255","255","255"),localStorage.setItem("color",a.color)),a.inputColorLabel.style.backgroundColor=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.inputPrevColor.style.backgroundColor=`rgb(${a.prevColor[0]}, ${a.prevColor[1]}, ${a.prevColor[2]})`)}}function y(){s(a.toolButtons),v(),a.toolButtons[a.toolButtonsName.indexOf("selectColor")].button.classList.add("button-highlight"),document.body.addEventListener("mousedown",L)}function w(){s(a.toolButtons),v(),a.toolButtons[a.toolButtonsName.indexOf("eraser")].button.classList.add("button-highlight"),a.canvas.node.addEventListener("mousedown",u),a.canvas.node.addEventListener("mousemove",h)}function C(e){if(a.isMouseWrite){const t=Math.floor(e.offsetX/a.koeffSize),n=Math.floor(e.offsetY/a.koeffSize);a.canvas.ctx.fillRect(t,n,a.widthLine,a.widthLine);const o=Math.abs(t-a.xBeginPath),i=Math.abs(n-a.yBeginPath),s=a.xBeginPath<t?1:-1,l=a.yBeginPath<n?1:-1;let{xBeginPath:r}=a,{yBeginPath:c}=a,d=o-i;for(;r!==t||c!==n;){a.canvas.ctx.fillRect(r,c,a.widthLine,a.widthLine);const e=2*d;e>-i&&(d-=i,r+=s),e<o&&(d+=o,c+=l)}}}function P(){s(a.toolButtons),v(),a.toolButtons[a.toolButtonsName.indexOf("stroke")].button.classList.add("button-highlight"),a.canvasAux.node.style.zIndex="2",a.canvasAux.ctx.clearRect(0,0,a.canvasAux.node.width,a.canvasAux.node.height),a.canvasAux.node.addEventListener("mousedown",c),a.canvasAux.node.addEventListener("mousemove",d),a.canvasAux.node.addEventListener("mouseup",C)}function S(){const e=a.toolButtons[a.toolButtonsName.indexOf("clearCanvas")].button;e.classList.add("button-highlight"),setTimeout(()=>{e.classList.remove("button-highlight")},100),a.canvas.ctx.clearRect(0,0,a.canvas.node.width,a.canvas.node.height),f()}function E(e){s(a.toolMiniButtons),this.button.classList.add("mini-line-button-highlight"),a.widthLine=e}n(14);class I{constructor(){this.colorMenu=document.createElement("div"),this.curColor=document.createElement("label"),this.inputColor=document.createElement("input"),this.prevColor=document.createElement("div"),this.changeButton=document.createElement("div"),this.colorMenu.classList.add("color-menu"),this.curColor.classList.add("color-menu__cur-color"),this.prevColor.classList.add("color-menu__prev-color"),this.inputColor.classList.add("color-menu__input"),this.changeButton.classList.add("color-menu__change-button"),this.inputColor.type="color",this.inputColor.id="color",this.curColor.htmlFor="color",a.inputColor=this.inputColor,a.inputColorLabel=this.curColor,a.inputPrevColor=this.prevColor}initListeners(e,t){this.changeButton.addEventListener("click",e),this.inputColor.addEventListener("change",t)}appendMenu(e){this.colorMenu.appendChild(this.curColor),this.colorMenu.appendChild(this.prevColor),this.colorMenu.appendChild(this.inputColor),this.colorMenu.appendChild(this.changeButton),e.appendChild(this.colorMenu)}}function B(){localStorage.setItem("prevColor",localStorage.getItem("color")),localStorage.setItem("color",a.color),a.prevColor=localStorage.getItem("prevColor").split(","),a.inputColorLabel.style.backgroundColor=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.inputPrevColor.style.backgroundColor=`rgb(${a.prevColor[0]}, ${a.prevColor[1]}, ${a.prevColor[2]})`}function N(){const e=parseInt(a.inputColor.value[1]+a.inputColor.value[2],16),t=parseInt(a.inputColor.value[3]+a.inputColor.value[4],16),n=parseInt(a.inputColor.value[5]+a.inputColor.value[6],16);localStorage.getItem("color")!==`${e},${t},${n},255`&&(a.color[0]=e,a.color[1]=t,a.color[2]=n,a.color[3]="255",B(),a.inputColorLabel.style.backgroundColor=`rgb(${e},${t},${n})`)}function k(){const e=localStorage.getItem("prevColor");a.color=e.split(","),B()}function M(){s(a.toolButtons),v(),a.toolButtons[a.toolButtonsName.indexOf("paintAllPixels")].button.classList.add("button-highlight"),a.canvas.ctx.lineWidth=a.widthLine,a.canvas.node.addEventListener("click",g)}class ${constructor(){this.toolsPanel=document.createElement("div"),this.lineWidthPanel=document.createElement("div"),this.toolsPanel.classList.add("tools-panel"),this.lineWidthPanel.classList.add("tools-panel__line-width"),this.buttons=[],this.miniButtons=[],a.listenerFunc={pensil:b,paintBucket:x,paintAllPixels:M,selectColor:y,eraser:w,stroke:P,clearCanvas:S}}appendPanel(e){a.miniLineArray.forEach((e,t)=>{const n=new i;t||n.button.classList.add("mini-line-button-highlight"),n.addStyle(e),n.appendButton(this.lineWidthPanel),n.initListener(E.bind(n,t+1)),this.miniButtons[t]=n}),this.toolsPanel.appendChild(this.lineWidthPanel),this.buttonsName=Object.keys(a.imgCoord),this.buttonsName.forEach((e,t)=>{const n=new o(e);n.addImage(a.imgCoord[e]),n.appendButton(this.toolsPanel),n.initListener(a.listenerFunc[e]),this.buttons[t]=n}),this.colorMenu=new I,this.colorMenu.appendMenu(this.toolsPanel),this.colorMenu.initListeners(k,N),a.toolMiniButtons=this.miniButtons,a.toolButtons=this.buttons,a.toolButtonsName=this.buttonsName,localStorage.getItem("color")?(a.color=localStorage.getItem("color").split(","),a.previousColor=localStorage.getItem("prevColor").split(","),a.inputColorLabel.style.backgroundColor=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.inputPrevColor.style.backgroundColor=`rgb(${a.previousColor[0]}, \n          ${a.previousColor[1]}, ${a.previousColor[2]})`):(localStorage.setItem("color","0,0,0,255"),localStorage.setItem("prevColor","255,255,255,0"),a.inputColorLabel.style.backgroundColor="rgb(0, 0, 0)",a.inputPrevColor.style.backgroundColor="rgb(255, 255, 255)"),e.appendChild(this.toolsPanel)}}n(16);function A(e,t){s(a.sizeButtons),a.sizeButtons[a.sizeArray.indexOf(`x${t}`)].button.classList.add("button-highlight"),localStorage.setItem("canvas",a.canvas.node.toDataURL()),a.canvas.node.height=t,a.canvas.node.width=t,a.canvasAux.node.height=t,a.canvasAux.node.width=t,a.animationPlayer.height=t,a.animationPlayer.width=t,a.koeffSize=e,localStorage.setItem("canvasSize",a.canvas.node.width),localStorage.setItem("sizeKoeff",a.koeffSize),a.canvas.ctx.imageSmoothingEnabled=!1,a.frames.forEach(e=>{const n=e,o=new Image,i=n.childNodes[0].childNodes[0].width,s=n.childNodes[0].childNodes[0].getContext("2d");o.src=n.childNodes[0].childNodes[0].toDataURL(),n.childNodes[0].childNodes[0].width=t,n.childNodes[0].childNodes[0].height=t,o.onload=()=>{s.clearRect(0,0,t,t),s.drawImage(o,0,0,i,i),e===a.currentFrame&&a.canvas.ctx.drawImage(o,0,0,i,i)}})}class R{constructor(){this.sizePanel=document.createElement("div"),this.sizePanel.classList.add("size-panel"),this.buttons=[]}appendPanel(e){a.sizeArray.forEach((e,t)=>{const n=new o(e),a=function(e){const t=2**e*32;return[512/t,t]}(t);n.addImage(e),n.initListener(A.bind(n,a[0],a[1])),n.button.classList.add(`x${a[1]}`),n.appendButton(this.sizePanel),this.buttons[t]=n,a[1]===+localStorage.getItem("canvasSize")&&n.button.classList.add("button-highlight")}),a.sizeButtons=this.buttons,e.appendChild(this.sizePanel)}}n(18);class z{constructor(e){"main"===e?(this.canvas=a.canvas.node,this.ctx=a.canvas.ctx,a.canvas.ctx.fillStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,a.canvas.ctx.strokeStyle=`rgb(${a.color[0]}, ${a.color[1]}, ${a.color[2]})`,localStorage.getItem("canvasSize")?(a.canvas.node.width=localStorage.getItem("canvasSize"),a.canvas.node.height=localStorage.getItem("canvasSize"),a.koeffSize=+localStorage.getItem("sizeKoeff")):(localStorage.setItem("canvasSize",32),localStorage.setItem("sizeKoeff",16),a.canvas.node.width="32",a.canvas.node.height="32",a.koeffSize=16),a.canvas.node.addEventListener("mouseout",()=>{a.isMouseWrite=!1,a.canvasFocus=!1}),a.canvas.node.addEventListener("mousemove",e=>{a.canvasFocus=!0}),document.body.addEventListener("mouseup",()=>{f(),a.isMouseWrite=!1}),a.canvas.ctx.imageSmoothingEnabled=!1):(this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),a.canvasAux={node:this.canvas,ctx:this.ctx},this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.background="none",this.canvas.style.zIndex="-1",a.color=localStorage.getItem("color").split(","),a.previousColor=localStorage.getItem("prevColor").split(","),a.canvasAux.node.width=localStorage.getItem("canvasSize"),a.canvasAux.node.height=localStorage.getItem("canvasSize"),a.canvasAux.node.addEventListener("mouseout",e=>{a.isMouseWrite&&(C(e),a.canvasAux.ctx.clearRect(0,0,a.canvasAux.node.width,a.canvasAux.node.height)),a.isMouseWrite=!1,a.canvasFocus=!1}),document.body.addEventListener("mouseup",()=>{a.canvasAux.ctx.clearRect(0,0,a.canvasAux.node.width,a.canvasAux.node.height)}),a.canvasAux.node.addEventListener("mousemove",e=>{a.canvasFocus=!0})),this.canvas.classList.add("canvas")}appendCanvas(e){e.appendChild(this.canvas)}}n(21);function F(){a.frames.forEach((e,t)=>{e.childNodes[0].childNodes[1].textContent=t+1})}function W(){1===a.frames.length?(a.frames[0].childNodes[0].childNodes[2].style.display="none",a.frames[0].childNodes[0].childNodes[4].style.display="none"):(a.frames[0].childNodes[0].childNodes[2].style.display="block",a.frames[0].childNodes[0].childNodes[4].style.display="block")}function _(e){const t=e;t.childNodes[0].childNodes[2].style.visibility="visible",t.childNodes[0].childNodes[3].style.visibility="visible",t.childNodes[0].childNodes[4].style.visibility="visible"}function D(e){const t=e;t.childNodes[0].childNodes[2].style.visibility="hidden",t.childNodes[0].childNodes[3].style.visibility="hidden",t.childNodes[0].childNodes[4].style.visibility="hidden"}function O(e){let t=0;a.frameInterval=setInterval(()=>{const e=a.frames[t].childNodes[0].childNodes[0],n=new Image;n.src=e.toDataURL(),n.onload=()=>{a.animationCtx.clearRect(0,0,a.animationPlayer.width,a.animationPlayer.height),a.animationCtx.drawImage(n,0,0,a.animationPlayer.width,a.animationPlayer.height)},t+=1,t===a.frames.length&&(t=0)},e)}function Y(e){const t=(e.target||e.childNodes[0].childNodes[0]).closest(".frames-panel__frame");t&&(a.frames.forEach(e=>{e.childNodes[0].classList.remove("frame-highlight")}),t.classList.add("frame-highlight"),a.currentFrame=t.parentNode,function(e){const t=e.childNodes[0].childNodes[0],n=new Image;a.canvas.ctx.clearRect(0,0,a.canvas.node.width,a.canvas.node.height),n.src=t.toDataURL(),n.onload=()=>{a.canvas.ctx.drawImage(n,0,0,a.canvas.node.width,a.canvas.node.height)}}(a.currentFrame))}function K(e){e.removeEventListener("click",K),e.removeEventListener("mouseover",_),e.removeEventListener("mouseout",D),e.remove(),a.frames.splice(a.frames.indexOf(e),1),F(),W(),clearInterval(a.frameInterval),O(a.timeInterval),setTimeout(Y.bind(null,a.frames[a.frames.length-1]),0)}const T=80,X=13;function j(e,t,n){if(a.drag){const o=e,i=104,s=a.frames[a.frames.indexOf(t)+1],l=a.frames[a.frames.indexOf(t)-1];let r=0;if(o.style.top=`${n.pageY-T}px`,o.style.left=`${n.pageX-X}px`,n.pageY-a.startY>i/2&&s){s.after(t);const e=a.frames.indexOf(t),n=a.frames.indexOf(s);r=a.frames[e],a.frames[e]=a.frames[n],a.frames[n]=r,a.startY+=i}if(a.startY-n.pageY>i/2&&l){l.before(t);const e=a.frames.indexOf(t),n=a.frames.indexOf(l);r=a.frames[e],a.frames[e]=a.frames[n],a.frames[n]=r,a.startY-=i}F()}}function U(e,t){const n=e,o=t;n.style.position="relative",n.style.top="0",n.style.left="0",n.style.zIndex="1",a.drag=!1,o.style.border="none",document.body.removeEventListener("mousemove",a.move),document.body.removeEventListener("mouseup",a.drop)}function G(e,t,n){a.drag=!0;const o=e,i=t;a.startY=n.pageY,o.style.top=`${n.pageY-T}px`,o.style.left=`${n.pageX-X}px`,o.style.position="absolute",o.style.zIndex="4",i.style.border="3px dashed orange",a.move=j.bind(document.body,e,t),a.drop=U.bind(document.body,e,t),document.body.addEventListener("mousemove",a.move),document.body.addEventListener("mouseup",a.drop)}function H(e){const t=e.cloneNode(!0),n=e.childNodes[0].childNodes[0],o=t.childNodes[0].childNodes[0],i=o.getContext("2d");e.after(t);const s=new Image;s.src=n.toDataURL(),s.onload=()=>{i.drawImage(s,0,0,o.width,o.height)},t.childNodes[0].childNodes[2].style.display="block",t.childNodes[0].childNodes[4].style.display="block",t.childNodes[0].childNodes[2].style.visibility="hidden",t.childNodes[0].childNodes[3].style.visibility="hidden",t.childNodes[0].childNodes[4].style.visibility="hidden",t.addEventListener("mouseover",_.bind(t,t)),t.addEventListener("mouseout",D.bind(t,t)),t.childNodes[0].childNodes[2].addEventListener("click",K.bind(t,t)),t.childNodes[0].childNodes[3].addEventListener("click",H.bind(t,t)),t.childNodes[0].childNodes[4].addEventListener("mousedown",G.bind(t.childNodes[0].childNodes[4],t.childNodes[0],t)),a.frames.splice(a.frames.indexOf(e)+1,0,t),F(),W()}class J{constructor(){this.buttonAdd=document.createElement("li"),this.buttonAdd.classList.add("frames-panel__add-button"),this.buttonAdd.innerHTML='<div class="frames-panel__add-button_img" ></div>\n                                <div class="frames-panel__add-button_text">Add new frame</div>'}createFrame(){this.newFrameWrap=document.createElement("li"),this.newFrame=document.createElement("div"),this.canvas=document.createElement("canvas"),this.number=document.createElement("div"),this.buttonDel=document.createElement("div"),this.buttonDublic=document.createElement("div"),this.buttonMove=document.createElement("div"),this.canvas.width=localStorage.getItem("canvasSize")||"32",this.canvas.height=localStorage.getItem("canvasSize")||"32",this.newFrameWrap.classList.add("frame-wrapper"),this.newFrame.classList.add("frames-panel__frame"),this.number.classList.add("frames-panel__frame_number"),this.buttonDel.classList.add("frames-panel__frame_del-button"),this.buttonDublic.classList.add("frames-panel__frame_dbl-button"),this.buttonMove.classList.add("frames-panel__frame_move-button"),this.newFrame.appendChild(this.canvas),this.newFrame.appendChild(this.number),this.newFrame.appendChild(this.buttonDel),this.newFrame.appendChild(this.buttonDublic),this.newFrame.appendChild(this.buttonMove),this.newFrameWrap.appendChild(this.newFrame),this.buttonMove.addEventListener("mousedown",G.bind(this.buttonMove,this.newFrame,this.newFrameWrap)),this.newFrame.addEventListener("mouseover",_.bind(this.newFrameWrap,this.newFrameWrap)),this.newFrame.addEventListener("mouseout",D.bind(this.newFrameWrap,this.newFrameWrap)),this.buttonDel.addEventListener("click",K.bind(this.newFrameWrap,this.newFrameWrap)),this.buttonDublic.addEventListener("click",H.bind(this.newFrameWrap,this.newFrameWrap)),this.buttonAdd.before(this.newFrameWrap),a.frames.push(this.newFrameWrap),a.currentFrame=this.newFrame,F(),W(),Y(this.newFrameWrap)}appendButton(e){e.appendChild(this.buttonAdd)}}class q{constructor(){if(this.framesPanel=document.createElement("ul"),this.framesPanel.classList.add("frames-panel"),a.framesPanel=this.framesPanel,a.frames=[],a.frameWrappers=[],this.frameBar=new J,this.frameBar.appendButton(this.framesPanel),localStorage.getItem("frames"))!function(e){if(localStorage.getItem("frames")){JSON.parse(localStorage.getItem("frames")).forEach((t,n)=>{e();const o=a.frames[n].childNodes[0].childNodes[0],i=o.getContext("2d"),s=new Image;s.src=t,s.onload=()=>{i.drawImage(s,0,0,o.width,o.height),n===a.frames.length-1&&Y(a.frames[a.frames.length-1])}})}}(this.frameBar.createFrame.bind(this.frameBar));else{this.frameBar.createFrame();const e=a.frames[0];a.currentFrame=e}this.frameBar.buttonAdd.addEventListener("click",this.frameBar.createFrame.bind(this.frameBar)),this.framesPanel.addEventListener("click",Y)}appendPanel(e){e.appendChild(this.framesPanel)}}n(25);class Q{constructor(){this.range=document.createElement("input"),this.fpsText=document.createElement("div"),this.range.classList.add("animation-panel__range"),this.fpsText.classList.add("animation-panel__fps-text"),this.range.type="range",this.range.min=1,this.range.max=24,this.range.value=12,this.fpsText.textContent=`${this.range.value} fps`}initListener(e){this.range.addEventListener("change",e)}}function V(e,t){const n=e,o=t.target.value,i=1e3/a.animationRange.value;a.timeInterval=i,n.textContent=`${o} fps`,clearInterval(a.frameInterval),O(i)}function Z(){this.animationPanel.classList.toggle("full-screen"),this.animationPlayer.classList.toggle("full-screen-player"),this.animationRange.range.classList.toggle("full-screen-range"),this.animationRange.fpsText.classList.toggle("full-screen-fps")}class ee{constructor(){this.animationPanel=document.createElement("div"),this.animationPlayer=document.createElement("canvas"),this.buttonFullScreen=document.createElement("div"),this.animationCtx=this.animationPlayer.getContext("2d"),this.animationRange=new Q,this.animationPanel.classList.add("animation-panel"),this.animationPlayer.classList.add("animation-panel__player"),this.buttonFullScreen.classList.add("animation-panel__screen-button"),this.buttonFullScreen.addEventListener("click",Z.bind(this)),this.animationRange.initListener(V.bind(this.AnimationRange,this.animationRange.fpsText)),this.animationPlayer.width=a.canvas.node.width,this.animationPlayer.height=a.canvas.node.height,a.animationPlayer=this.animationPlayer,a.animationCtx=this.animationCtx,a.animationRange=this.animationRange.range}animationStart(){this.timeInterval=1e3/+this.animationRange.range.value,a.timeInterval=this.timeInterval,O(this.timeInterval)}appendPanel(e){this.animationPanel.appendChild(this.animationPlayer),this.animationPanel.appendChild(this.buttonFullScreen),this.animationPanel.appendChild(this.animationRange.fpsText),this.animationPanel.appendChild(this.animationRange.range),e.appendChild(this.animationPanel)}}n(27);function te(){const e=Math.round(1e3/a.timeInterval),t=a.canvas.node.width,n=new GIFEncoder;n.setSize(t,t),n.setRepeat(0),n.setFrameRate(e),n.start(),a.frames.forEach(e=>{const t=e.childNodes[0].childNodes[0].getContext("2d");n.addFrame(t)}),n.finish(),n.download("piskel.gif")}function ne(){const e=[];a.frames.forEach(t=>{const n=t.childNodes[0].childNodes[0].toDataURL();e.push(n)}),localStorage.setItem("frames",JSON.stringify(e))}class ae{constructor(){this.exportPanel=document.createElement("div"),this.exportPanel.classList.add("export-panel"),this.gifExport=new o("gif"),this.gifExport.addImage([0,-182]),this.gifExport.appendButton(this.exportPanel),this.gifExport.initListener(te),this.saveLocal=new o("local"),this.saveLocal.addImage([-228,0]),this.saveLocal.appendButton(this.exportPanel),this.saveLocal.initListener(ne)}appendPanel(e){e.appendChild(this.exportPanel)}}n(29);function oe(){const e=new firebase.auth.GoogleAuthProvider;e.addScope("https://www.googleapis.com/auth/contacts.readonly"),firebase.auth().signInWithPopup(e).then(e=>{a.registration.button.style.display="none",a.registration.afterWindow.style.display="flex",a.registration.afterWindow.childNodes[0].src=e.user.photoURL,a.registration.afterWindow.childNodes[1].textContent=e.user.displayName}).catch(()=>{alert("Registration Error")})}class ie{constructor(){this.header=document.createElement("header"),this.title=document.createElement("h1"),this.regButton=document.createElement("div"),this.afterRegWindow=document.createElement("div"),this.afterRegImg=document.createElement("img"),this.afterRegText=document.createElement("span"),this.regButton.classList.add("registr-button"),this.afterRegWindow.classList.add("after-reg-window"),this.afterRegImg.setAttribute("alt","avatar"),this.regButton.textContent="Sign in",this.title.textContent="SiMPLE PiSKEL CLONE",this.regButton.addEventListener("click",oe),firebase.initializeApp({apiKey:"AIzaSyCDMM_bonnST-eMQb7WBsMLYabP1o426uc",authDomain:"simple-piskel-clone-caca9.firebaseapp.com",databaseURL:"https://simple-piskel-clone-caca9.firebaseio.com",projectId:"simple-piskel-clone-caca9",storageBucket:"simple-piskel-clone-caca9.appspot.com",messagingSenderId:"974544426259",appId:"1:974544426259:web:90ca7619aea983b49236e6",measurementId:"G-DYKKF6NDTX"}),firebase.analytics(),a.firebase=firebase,a.registration={button:this.regButton,afterWindow:this.afterRegWindow}}appendHeader(e){this.header.appendChild(this.title),this.header.appendChild(this.regButton),this.afterRegWindow.appendChild(this.afterRegImg),this.afterRegWindow.appendChild(this.afterRegText),this.header.appendChild(this.afterRegWindow),e.appendChild(this.header)}}const se=document.querySelector(".wrapper");(new class{constructor(){this.main=document.createElement("main"),this.main.setAttribute("onselectstart","return false"),this.canvasWrap=document.createElement("div"),this.container=document.createElement("div"),this.rightButtonCont=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrapper"),this.container.classList.add("canvases-container"),this.rightButtonCont.classList.add("size-export-container");const e=document.createElement("canvas"),t=e.getContext("2d");a.canvas={node:e,ctx:t}}appendApp(e){this.header=new ie,this.header.appendHeader(e),this.toolsPanel=new $,this.toolsPanel.appendPanel(this.main),this.framesPanel=new q,this.framesPanel.appendPanel(this.main),this.canvas=new z("main"),this.canvas.appendCanvas(this.canvasWrap),this.canvasAux=new z("auxiliary"),this.canvasAux.appendCanvas(this.canvasWrap),this.container.appendChild(this.canvasWrap),this.main.appendChild(this.container),this.animationPanel=new ee,this.animationPanel.appendPanel(this.main),this.animationPanel.animationStart(),this.sizePanel=new R,this.sizePanel.appendPanel(this.rightButtonCont),this.exportPanel=new ae,this.exportPanel.appendPanel(this.rightButtonCont),this.main.appendChild(this.rightButtonCont),e.appendChild(this.main)}}).appendApp(se),window.addEventListener("keydown",(function(e){Object.keys(a.keyboardKeys).forEach(t=>{t===e.code&&a.listenerFunc[a.keyboardKeys[t]]()})}))},function(e,t){},,,,function(e,t){},,function(e,t){},,,,function(e,t){},,function(e,t){},,function(e,t){},,function(e,t){},,,function(e,t){},,,,function(e,t){},,function(e,t){},,function(e,t){}]);